# パート勤怠 & 扶養内シミュレーター

ローカルのみで動作する勤怠カレンダー。スタッフごとの出勤簿を管理し、**希望票（日本語テキスト）をAI的に解析して自動割付**します。  
103/106/130 万円ラインの年収見込みバー、**CSV / Excel(.xlsx) エクスポート**、祝日自動取得、前月→今月コピー等をサポート。

**デモ**（GitHub Pages）: `https://<あなたのGitHubユーザー名>.github.io/<リポジトリ名>/`

---

## 特長
- **希望票（テキスト）→ カレンダー自動反映**
  - 例:「扶養の範囲内」「月・火・木のみ出勤」「勤務時間は4時間」「祝日は休み」
  - *のみ/だけ/以外/平日のみ* などの排他的指定に対応（上書きON時は他曜日を自動で休みに）
  - 0.25h刻み（30分=0.5）
- **年収見込み (103/106/130 万 / カスタムA/B)**
- **CSV / Excel(.xlsx) エクスポート**（ボタン押下でダウンロード）
- **祝日API自動取得 & キャッシュ**（holidays-jp → Nager.Date フォールバック）
- **前月コピー**（空欄のみ / 完全上書き）
- **完全フロントエンド（localStorage保存・サーバ不要）**

---

## 1. 動作要件
- モダンブラウザ（Chrome / Edge / Safari / Firefox）
- インターネット接続（祝日API・ExcelライブラリCDN用）
  - オフライン時は祝日取得が失敗します（キャッシュがあればそれを使用）

---

## 2. セットアップ（ローカル）
1. このリポジトリを `Clone` または `Download ZIP`。
2. フォルダ直下に以下ファイルがあることを確認：
index.html
script.js
style.css
docs/report.md
3. `index.html` をダブルクリックしてブラウザで開くだけで実行できます（サーバ不要）。

> ⚠️ ローカルのセキュリティ設定で外部CDNやダウンロードがブロックされると、Excel出力やボタンダウンロードが動かない場合があります。  
> その際は簡易サーバを使うと安定します（例: `python -m http.server` で http://localhost:8000 を開く）。

---

## 3. GitHub Pages（公開デモ）
1. GitHubで新規リポジトリを作成し、上記ファイルをアップロード。
2. `Settings` → `Pages` → **Branch: `main` / Folder: `/ (root)`** を選択 → `Save`。
3. 数十秒後、`https://<ユーザー名>.github.io/<リポジトリ名>/` が公開URLになります。

---

## 4. 使い方
1. **スタッフ管理**
- タブでスタッフ切替、`＋ スタッフ追加`、`− スタッフ削除`、並び替え（← →）
- 時給を入力 → `保存`
2. **対象月**
- 前月/翌月または `YYYY-MM` で切替
3. **希望票（テキスト）→ 反映**
- 例を貼付：
  ```
  扶養の範囲内で。
  月・火・木のみ出勤。
  勤務時間は4時間。
  祝日は休み。
  15日は休み、22日は入れます。
  ```
- 必要なら「既存の入力を優先（空欄のみ埋める）」にチェック
- **「AI解析して反映」** をクリック → カレンダー自動反映
4. **カレンダー**
- 各日で「出勤/休み」切替、時間は数値入力（30分=0.5、15分=0.25）
5. **月次集計 & 年収見込み**
- 進捗バーでライン到達度合いを確認
- カスタムA/Bで任意の年額ラインを追加
6. **年間サマリー**
- 「再計算」で最新化
7. **前月コピー**
- 「空欄のみ」または「全て上書き」を選択
8. **エクスポート**
- ページ最下部の **CSV（今月） / CSV（全体） / Excel（今月）** ボタンをクリック
- クリックしたボタンは青ハイライト表示（直近操作）

---

## 5. データ保存
- データはすべてブラウザの **localStorage** に保存されます。
- 「データ初期化」で全削除できます（ブラウザ単位）。

---

## 6. 祝日APIとキャッシュ
- 祝日: `holidays-jp.github.io` → 失敗時 `date.nager.at`
- キャッシュTTL: 30日  
- 取得状況は画面上部「祝日データ：...」に表示

---

## 7. よくある質問 / トラブルシュート
- **Excelがダウンロードできない**  
→ CDNブロック、またはブラウザのダウンロード制限を確認。簡易ローカルサーバ経由で解決することが多いです。
- **AI解析の反映が弱い**  
→ 「〜のみ/だけ/以外/平日のみ」などの排他的表現は、**上書きON時**に他曜日を休みにします。時給が未設定だと「扶養上限」から導く月上限時間を計算できないため、**時給を先に設定**してください。
- **祝日が表示されない**  
→ オフラインまたはAPIブロック。再読込、別ネットワーク、または時間をおいてお試しください。

---

## 8. 開発メモ
- Frameworkなし・ビルドなし（純粋な HTML/CSS/JS）。
- 依存はCDN読み込みのみ（xlsx）。
- 主要ロジック: `script.js` の `parseWishText` / `planAutoAssignment` / `applyWishPlan`。

---

## ライセンス
社内利用限定（提出先企業ポリシーに合わせて変更してください）。
